train = read.csv("~/Desktop/DSO530 Applied Modern Statistical Learning Methods/Final Project/train_meanEncodingNew.csv")
test = read.csv("~/Desktop/DSO530 Applied Modern Statistical Learning Methods/Final Project/test_meanEncodingNew.csv")

train = subset(train, select = -X)
test = subset(test, select = -X)

train$HasDetections = as.character(train$HasDetections)
train$HasDetections = as.factor(train$HasDetections)
test$HasDetections = as.character(test$HasDetections)
test$HasDetections = as.factor(test$HasDetections)

train = subset(train, select = c('EngineVersion',
                                  'AVProductsInstalled',
                                  'OrganizationIdentifier',
                                  'GeoNameIdentifier',
                                  'LocaleEnglishNameIdentifier',
                                  'Processor.x64',
                                  'OsSuite.768',
                                  'OsPlatformSubRelease',
                                  'IsProtected',
                                  'SmartScreen.RequireAdmin',
                                  'Census_MDC2FormFactor',
                                  'Census_OEMNameIdentifier',
                                  'Census_OEMModelIdentifier',
                                  'Census_ProcessorCoreCount',
                                  'Census_PrimaryDiskTotalCapacity',
                                  'Census_PrimaryDiskTypeName.others',
                                  'Census_PrimaryDiskTypeName.SSD',
                                  'Census_TotalPhysicalRAM',
                                  'Census_ChassisTypeName.Notebook',
                                  'Census_ChassisTypeName.others',
                                  'Census_OSBuildNumber',
                                  'Census_OSSkuName.CORE_SINGLELANGUAGE',
                                  'Census_OSInstallTypeName',
                                  'Census_OSWUAutoUpdateOptionsName.Notify',
                                  'Census_OSWUAutoUpdateOptionsName.UNKNOWN',
                                  'Census_ActivationChannel.Retail',
                                  'Census_ActivationChannel.Volume.GVLK',
                                  'Census_IsSecureBootEnabled',
                                  'Census_IsAlwaysOnAlwaysConnectedCapable',
                                  'Wdft_IsGamer',
                                  'AppVersion',
                                  'AvSigVersion',
                                  'AVProductStatesIdentifier',
                                  'CountryIdentifier',
                                  'CityIdentifier',
                                  'Census_ProcessorModelIdentifier',
                                  'Census_OSVersion',
                                  'Census_FirmwareVersionIdentifier',
                                 'HasDetections'))
                   
test = subset(test, select = c('EngineVersion',
                                  'AVProductsInstalled',
                                  'OrganizationIdentifier',
                                  'GeoNameIdentifier',
                                  'LocaleEnglishNameIdentifier',
                                  'Processor.x64',
                                  'OsSuite.768',
                                  'OsPlatformSubRelease',
                                  'IsProtected',
                                  'SmartScreen.RequireAdmin',
                                  'Census_MDC2FormFactor',
                                  'Census_OEMNameIdentifier',
                                  'Census_OEMModelIdentifier',
                                  'Census_ProcessorCoreCount',
                                  'Census_PrimaryDiskTotalCapacity',
                                  'Census_PrimaryDiskTypeName.others',
                                  'Census_PrimaryDiskTypeName.SSD',
                                  'Census_TotalPhysicalRAM',
                                  'Census_ChassisTypeName.Notebook',
                                  'Census_ChassisTypeName.others',
                                  'Census_OSBuildNumber',
                                  'Census_OSSkuName.CORE_SINGLELANGUAGE',
                                  'Census_OSInstallTypeName',
                                  'Census_OSWUAutoUpdateOptionsName.Notify',
                                  'Census_OSWUAutoUpdateOptionsName.UNKNOWN',
                                  'Census_ActivationChannel.Retail',
                                  'Census_ActivationChannel.Volume.GVLK',
                                  'Census_IsSecureBootEnabled',
                                  'Census_IsAlwaysOnAlwaysConnectedCapable',
                                  'Wdft_IsGamer',
                                  'AppVersion',
                                  'AvSigVersion',
                                  'AVProductStatesIdentifier',
                                  'CountryIdentifier',
                                  'CityIdentifier',
                                  'Census_ProcessorModelIdentifier',
                                  'Census_OSVersion',
                                  'Census_FirmwareVersionIdentifier',
                               'HasDetections'))

### LDA

library(MASS)

LDAtrain <- lda(HasDetections ~ ., train) 
LDAtrain
LDAp <- predict(LDAtrain, newdata=test)
LDAlab <- LDAp$class

xtabs(~test$HasDetections+LDAlab)
LDAacc=sum(test$HasDetections==LDAlab)/100000
LDAacc


### Decision tree

library(tree)

TREEtrain = tree(HasDetections ~ ., data = train)
summary(TREEtrain)

plot(TREEtrain)
text(TREEtrain, pretty=0, cex = 0.45)


### Classification Trees

library(rpart)

CTtrain = rpart(HasDetections ~ ., method="class", data=train)

printcp(CTtrain) 
plotcp(CTtrain) 
summary(CTtrain)

plot(CTtrain)
text(CTtrain, pretty=0, cex = 0.5)

CTpred = predict(CTtrain, newdata = test)
mean(test$HasDetections == CTpred)


### Regression Trees

RTtrain = rpart(HasDetections ~ ., method="anova", data=train)

printcp(RTtrain) 
plotcp(RTtrain) 
summary(RTtrain) 
rsq.rpart(RTtrain) 

plot(RTtrain) 
text(RTtrain, pretty=0, cex=.5) 

RTpred = predict(RTtrain, newdata = test)
mean(test$HasDetections == RTpred)

